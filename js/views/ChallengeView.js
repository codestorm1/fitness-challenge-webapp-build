define("views/ChallengeView",["jquery","backbone","mustache","fitness","models/ChallengeModel"],function(e,t,n,r,i){var s=t.View.extend({el:"#create",initialize:function(){this.render()},events:{"click #create_challenge_submit":"createChallengeSubmit"},render:function(){var t=e("#create_challenge_template"),r=e("#header_template"),i={},s=n.to_html(t.html(),i);return this.$el.empty(),this.$el.append(r.html()).append(t.html()),this.$el.trigger("create"),this},createChallengeSubmit:function(){var t=0,n=e("#challenge_type").val(),i=e("#start_date").val(),s=e("#end_date").val();(!i||!s)&&r.showMessage("Please enter a start and end date");var o=r.parseDate(i),u=r.parseDate(s),a=r.user.get("username")+"_"+n+"_"+i+"_"+s,f=StackMob.Model.extend({schemaName:"challenge"}),l=new f({challenge_id:a,challengetype:n,startdate:o.getTime(),enddate:u.getTime(),challengecreator:r.user.get("username"),users:[r.user.get("username")]});e.mobile.loading("show"),l.create({success:function(t){e.mobile.loading("hide");var n=r.user.get("friends");if(n&&n.length>0){var i=t.attributes.challenge_id,s=StackMob.Model.extend({schemaName:"invitation"}),o=n.length;for(var u=0;u<o;u++){var a=n[u],f=new s({challenge:i,challengeinviter:r.user.get("username"),inviteduser:a,responded:!1,accepted:!1});f.create({success:function(e){r.showMessage("invitation to "+e.get("inviteduser")+" saved")},error:function(e,t){r.showMessage("invitation to "+e.get("inviteduser")+" failed "+t||"")}})}}r.showMessage("Challenge created!")},error:function(t,n){e.mobile.loading("hide"),console.debug("Save challenge failed: "+n.error),n.error.indexOf("Duplicate")!==-1&&r.showMessage("You've already created that challenge"),typeof callback=="function"&&callback(!1)}})}});return s});