define("views/InvitationView",["jquery","backbone","mustache","fitness","customCodeClient"],function(e,t,n,r,i){var s=t.View.extend({initialize:function(){this.render()},events:{"click .invitation_accept":"acceptInvitation","click .invitation_decline":"declineInvitation"},render:function(){var t=e("#header_template"),r=e("#invitation_template"),i=this.model.get("challenge"),s=new Date(i.startdate),o=new Date(i.enddate),u="Total steps from "+s.toLocaleDateString()+" to "+o.toLocaleDateString(),a=i.users.length,f={invitation_id:this.model.get("invitation_id"),description:u,count:a},l=n.to_html(r.html(),f);return this.$el.empty(),this.$el.append(t.html()).append(l),this.$el.trigger("create"),this},saveModelChangePage:function(t){var n=StackMob.Model.extend({schemaName:"invitation"}),i=new n({invitation_id:this.model.get("invitation_id")});i.save(t,{success:function(t){console.debug(JSON.stringify(t.toJSON())),e.mobile.changePage("#invitation_list",{reverse:!0,changeHash:!0})},error:function(e,t){console.debug(t),r.showMessage("failed to update invitation")}})},acceptInvitation:function(e){function i(){var e={accepted:!0,responded:!0};t.model.set(e),t.saveModelChangePage(e)}var t=this;e.preventDefault();var n=this.model.get("challenge"),s=this.model.get("inviteduser").username;if(n.users.indexOf(s)===-1){var o=StackMob.Model.extend({schemaName:"challenge"}),u=new o({challenge_id:n.challenge_id});u.fetch({success:function(e){console.debug(JSON.stringify(e.toJSON()));var t=u.get("users");t.indexOf(s)===-1?(t.push(s),u.save({users:t},{success:function(e){console.debug(JSON.stringify(e.toJSON())),i()},error:function(e,t){console.debug(t),r.showMessage("failed to update challenge")}})):i()},error:function(e,t){console.debug(t)}})}else i()},declineInvitation:function(e){e.preventDefault();var t={accepted:!1,responded:!0};this.model.set(t),this.saveModelChangePage(t)}});return s});